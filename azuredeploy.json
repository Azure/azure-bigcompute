{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "adminUsername": {
            "type": "string",
            "metadata": {
                "description": "Username for the Virtual Machine."
            }
        },
        "adminPassword": {
            "type": "securestring",
            "metadata": {
                "description": "Password for the Virtual Machine."
            }
        },
        "imagePub": {
            "type": "string",
            "defaultValue": "MicrosoftWindowsServer",
            "allowedValues": [
                "MicrosoftWindowsServer"
            ],
            "metadata": {
                "description": "Windows image publisher"
            }
        },

        "imageOff": {
            "type": "string",
            "defaultValue": "WindowsServer",
            "allowedValues": [
                "WindowsServer",
                "Windows-HUB"
            ],
            "metadata": {
                "description": "Windows image offer"
            }
        },
        "VMSku": {
            "type": "string",
            "defaultValue": "2016-Datacenter",
            "allowedValues": [
                "2016-Datacenter",
                "Windows-10-HUB"
            ],
            "metadata": {
                "description": "Windows SKUs for GPU"
            }
        },
        "imagever": {
            "type": "string",
            "defaultValue": "latest",
            "allowedValues": [
                "latest",
                "10.0.20170228"
            ],
            "metadata": {
                "description": "Windows image versions"
            }
        },
        "VMType": {
            "type": "string",
            "defaultValue": "Standard_NV24",
            "allowedValues": [
                "Standard_NV6",
                "Standard_NV12",
                "Standard_NV24"
            ],
            "metadata": {
                "description": "GPU VM Types for M60"
            }
        },
        "VMName": {
            "type": "string",
            "defaultValue": "vw16vm",
            "metadata": {
                "description": "The VMName"
            }
        },
        "VNetName": {
            "type": "string",
            "defaultValue": "vnet",
            "metadata": {
                "description": "The VNetName"
            }
        },
        "VMnicName": {
            "type": "string",
            "defaultValue": "nic",
            "metadata": {
                "description": "The Nicname"
            }
        },
        "subPrefix": {
            "type": "string",
            "defaultValue": "10.1.1.0/24",
            "metadata": {
                "description": "The Subnet Prefix, please change CIDR NS   for deploying to existing VNets "
            }
        },
        "addPrefix": {
            "type": "string",
            "defaultValue": "10.1.1.0/24",
            "metadata": {
                "description": "The address Prefix for the VNet. Please change for deploying to existing vnet with an existing addressspace "
            }
        },
        "subName": {
            "type": "string",
            "defaultValue": "sub",
            "metadata": {
                "description": "The Subnet Name"
            }
        },
        "numDataDisks": {
            "type": "int",
            "defaultValue": 16,
            "maxValue": 64,
            "allowedValues": [
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10,
                11,
                12,
                13,
                14,
                15,
                16,
                17,
                18,
                19,
                20,
                21,
                22,
                23,
                24,
                25,
                26,
                27,
                28,
                29,
                30,
                31,
                32,
                33,
                35,
                36,
                37,
                38,
                39,
                40,
                41,
                42,
                43,
                44,
                45,
                46,
                47,
                48,
                49,
                50,
                51,
                52,
                53,
                54,
                55,
                56,
                57,
                58,
                59,
                60,
                61,
                62,
                63,
                64
            ],
            "metadata": {
                "description": "This parameter allows the user to select the number of disks they want"
            }
        },
        "nvidiaVer": {
            "type": "string",
            "defaultValue": "369.95",
            "allowedValues": [
                "369.95",
                "369.71"
            ],
            "metadata": {
                "description": "The NVIDIA Version"
            }
        },
        "publicIPAddressName": {
            "type": "string",
            "defaultValue": "nvpublic",
            "metadata": {
                "description": "The Public Address Name"
            }
        },
        "ipConfigurationsName": {
            "type": "string",
            "defaultValue": "ipconfig1",
            "metadata": {
                "description": "The ip Configuration Name. please change for deploying to existing vnet."
            }
        },
        "allocationMethod": {
            "type": "string",
            "defaultValue": "Dynamic",
            "allowedValues": [
                "Dynamic",
                "Static"
            ],
            "metadata": {
                "description": "The Public Address Allocation Static or Dynamic"
            }
        },
        "useSpecificAzureDriver": {
            "type": "string",
            "defaultValue": "No",
            "allowedValues": [
                "Yes",
                "No"
            ],
            "metadata": {
                "description": "Use specific Azure GRID Driver for NVIDIA Version"
            }
        },
        "CorrespondingAzureLocation": {
            "type": "string",
            "defaultValue": "https://go.microsoft.com/fwlink/?linkid=836843",
            "metadata": {
                "description": "Use specific Azure GRID Signed Driver Location for NVIDIA Version"
            }
        },
        "license": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "The Teradici Agent license Activation Code trial @ http://connect.teradici.com/cas-trial"
            }
        },
        "teradiciAgentVer": {
            "type": "string",
            "defaultValue": "2.8.0.5813",
            "allowedValues": [
                "2.8.0.5813",
                "2.8.0.5614",
                "2.7.0.4060"
            ],
            "metadata": {
                "description": "The Teradici Agent Version - latest is 2.8.0.5813 - Beta"
            }
        },

        "OMSWorkSpaceId": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "(Optional- Keep Blank if not used) The Workspace ID for the OMS Portal Workspace."
            }
        },
        "OMSWorkSpaceKey": {
            "type": "securestring",
            "defaultValue": "",
            "metadata": {
                "description": "(Optional- Keep Blank if not used) The OMS Portal Workspace key"
            }
        },
        "softwareExeNameinfolder": {
            "type": "string",
            "defaultValue": "opendTect/OpendTect_Installer_win64.exe",
            "allowedValues": [
                "opendTect/OpendTect_Installer_win64.exe",
                "noinstall"
            ],
            "metadata": {
                "description": "The software to install"
            }
        },
        "NuGetminVer4DockerEE": {
            "type": "string",
            "defaultValue": "2.8.5.208",
            "metadata": {
                "description": "NuGet minimum version requirement- Docker 17.03.0-ee for Windows Server 2016 DC"
            }
        },
        "leostreamAgentVer": {
            "type": "string",
            "defaultValue": "6-2-7-0",
            "metadata": {
                "description": "The Leostream Agent Version"
            }
        },
        "storageAcc": {
            "type": "string",
            "defaultValue": "tdcm16sg112leo8193ls102",
            "metadata": {
                "description": "The Storage Account Name for GRID Drivers - generic"
            }
        },
        "conName": {
            "type": "string",
            "defaultValue": "tdcm16sg112leo8193ls102",
            "metadata": {
                "description": "The Storage Container Name for Generic NVIDIA GRID 4.1 Driver"
            }
        },
        "_artifactsLocation": {
            "type": "string",
            "metadata": {
                "description": "The base URI where artifacts required by this template are located. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated."
            },
            "defaultValue": "https://raw.githubusercontent.com/Azure/azure-accessplatform-windows-gpu/master/"
        }
    },
    "variables": {
        "addressPrefix": "[parameters('addPrefix')]",
        "dnsNameForPublicIP": "[uniqueString(resourceGroup().id)]",
        "nicName": "[parameters('VMnicName')]",
        "subnetName": "[parameters('subName')]",
        "subnetPrefix": "[parameters('subPrefix')]",
        "vnetID": "[resourceId(resourceGroup().name, 'Microsoft.Network/virtualNetworks', variables('virtualNetworkName'))]",
        "subnetRef": "[concat(variables('vnetID'),'/subnets/', concat(parameters('VNetName'),variables('subnetName')))]",
        "vhdStorageAccountName": "[uniqueString(resourceGroup().id, 'storage')]",
        "sizeOfDataDisksInGB": 1022,
        "diskCaching": "ReadWrite",
        "virtualNetworkName": "[parameters('VNetName')]",
        "vmName": "[parameters('VMName')]",
        "nVIDIAdTeradiciLeostreamAgentsScriptFolder": "CustomScripts",
        "nVIDIAdTeradiciLeostreamAgentsScriptFileName": "nVIDIAdTeradiciLeostreamAgents.ps1",
        "diskArray": [{
                "name": "datadisk1",
                "lun": 0,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk1.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk2",
                "lun": 1,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk2.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk3",
                "lun": 2,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk3.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk4",
                "lun": 3,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk4.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk5",
                "lun": 4,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk5.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk6",
                "lun": 5,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk6.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk7",
                "lun": 6,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk7.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk8",
                "lun": 7,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk8.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk9",
                "lun": 8,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk9.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk10",
                "lun": 9,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk10.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk11",
                "lun": 10,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk11.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk12",
                "lun": 11,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk12.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk13",
                "lun": 12,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk13.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk14",
                "lun": 13,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk14.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk15",
                "lun": 14,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk15.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk16",
                "lun": 15,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk16.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk17",
                "lun": 16,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk17.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk18",
                "lun": 17,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk18.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk19",
                "lun": 18,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk19.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk20",
                "lun": 19,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk20.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk21",
                "lun": 20,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk21.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk22",
                "lun": 21,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk22.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk23",
                "lun": 22,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk23.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk24",
                "lun": 23,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk24.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk25",
                "lun": 24,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk25.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk26",
                "lun": 25,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk26.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk27",
                "lun": 26,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk27.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk28",
                "lun": 27,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk28.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk29",
                "lun": 28,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk29.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk30",
                "lun": 29,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk30.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk31",
                "lun": 30,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk31.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk32",
                "lun": 31,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk32.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk33",
                "lun": 32,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk33.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk34",
                "lun": 33,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk34.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk35",
                "lun": 34,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk35.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk36",
                "lun": 35,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk36.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk37",
                "lun": 36,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk37.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk38",
                "lun": 37,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk38.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk39",
                "lun": 38,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk39.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk40",
                "lun": 39,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk40.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk41",
                "lun": 40,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk41.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk42",
                "lun": 41,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk42.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk43",
                "lun": 42,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk43.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk44",
                "lun": 43,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk44.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk45",
                "lun": 44,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk45.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk46",
                "lun": 45,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk46.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk47",
                "lun": 46,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk47.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk48",
                "lun": 47,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk48.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk49",
                "lun": 48,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk49.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk50",
                "lun": 49,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk50.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk51",
                "lun": 50,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk51.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk52",
                "lun": 51,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk52.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk53",
                "lun": 52,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk53.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk54",
                "lun": 53,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk54.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk55",
                "lun": 54,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk55.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk56",
                "lun": 55,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk56.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk57",
                "lun": 56,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk57.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk58",
                "lun": 57,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk58.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk59",
                "lun": 58,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk59.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk60",
                "lun": 59,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk60.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk61",
                "lun": 60,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk61.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk62",
                "lun": 61,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk62.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk63",
                "lun": 62,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk63.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            },
            {
                "name": "datadisk64",
                "lun": 63,
                "vhd": {
                    "uri": "[concat('http://', variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/', 'datadisk64.vhd')]"
                },
                "createOption": "Empty",
                "caching": "[variables('diskCaching')]",
                "diskSizeGB": "[variables('sizeOfDataDisksInGB')]"
            }
        ]
    },
    "resources": [{
            "type": "Microsoft.Storage/storageAccounts",
            "name": "[variables('vhdStorageAccountName')]",
            "apiVersion": "2016-01-01",
            "location": "[resourceGroup().location]",
            "sku": {
                "name": "Standard_LRS"
            },
            "kind": "Storage",
            "properties": {}
        },
        {
            "apiVersion": "2016-09-01",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "[parameters('publicIPAddressName')]",
            "location": "[resourceGroup().location]",
            "properties": {
                "publicIPAllocationMethod": "[parameters('allocationMethod')]",
                "dnsSettings": {
                    "domainNameLabel": "[variables('dnsNameForPublicIP')]"
                }
            }
        },
        {
            "apiVersion": "2016-09-01",
            "type": "Microsoft.Network/virtualNetworks",
            "name": "[variables('virtualNetworkName')]",
            "location": "[resourceGroup().location]",
            "properties": {
                "addressSpace": {
                    "addressPrefixes": [
                        "[variables('addressPrefix')]"
                    ]
                },
                "subnets": [{
                    "name": "[concat(parameters('VNetName'),variables('subnetName'))]",
                    "properties": {
                        "addressPrefix": "[variables('subnetPrefix')]"
                    }
                }]
            }
        },
        {
            "apiVersion": "2016-09-01",
            "type": "Microsoft.Network/networkInterfaces",
            "name": "[variables('nicName')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[parameters('publicIPAddressName')]",
                "[variables('virtualNetworkName')]"
            ],
            "properties": {
                "ipConfigurations": [{
                    "name": "[parameters('ipConfigurationsName')]",
                    "properties": {
                        "privateIPAllocationMethod": "Dynamic",
                        "publicIPAddress": {
                            "id": "[resourceId('Microsoft.Network/publicIPAddresses',parameters('publicIPAddressName'))]"
                        },
                        "subnet": {
                            "id": "[variables('subnetRef')]"
                        }
                    }
                }]
            }
        },
        {
            "apiVersion": "2016-03-30",
            "type": "Microsoft.Compute/virtualMachines",
            "name": "[variables('vmName')]",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[variables('vhdStorageAccountName')]",
                "[variables('nicName')]"
            ],
            "properties": {
                "hardwareProfile": {
                    "vmSize": "[parameters('VMType')]"
                },
                "osProfile": {
                    "computerName": "[variables('vmName')]",
                    "adminUsername": "[parameters('adminUsername')]",
                    "adminPassword": "[parameters('adminPassword')]",
                    "windowsConfiguration": {
                        "provisionVmAgent": "true"
                    }
                },
                "storageProfile": {
                    "imageReference": {

                        "publisher": "[parameters('imagePub')]",
                        "offer": "[parameters('imageOff')]",
                        "sku": "[parameters('VMSku')]",
                        "version": "[parameters('imagever')]"
                    },
                    "osDisk": {
                        "name": "[parameters('VMName')]",
                        "createOption": "fromImage",
                        "managedDisk": {
                            "storageAccountType": "Standard_LRS"
                        }
                    },
                    "dataDisks": []
                },
                "networkProfile": {
                    "networkInterfaces": [{
                        "id": "[resourceId('Microsoft.Network/networkInterfaces',variables('nicName'))]"
                    }]
                }
            },
            "resources": [{
                "name": "nVIDIAdTeradiciLeostreamAgents",
                "type": "extensions",
                "location": "[resourceGroup().location]",
                "apiVersion": "2015-06-15",
                "dependsOn": [
                    "[resourceId('Microsoft.Compute/virtualMachines', variables('vmName'))]"
                ],
                "tags": {
                    "displayName": "nVIDIAdTeradiciLeostreamAgents"
                },
                "properties": {
                    "publisher": "Microsoft.Compute",
                    "type": "CustomScriptExtension",
                    "typeHandlerVersion": "1.8",
                    "autoUpgradeMinorVersion": true,
                    "settings": {
                        "fileUris": [
                            "[concat(parameters('_artifactsLocation'), variables('nVIDIAdTeradiciLeostreamAgentsScriptFolder'), '/', variables('nVIDIAdTeradiciLeostreamAgentsScriptFileName'))]"
                        ],
                        "commandToExecute": "[concat('powershell -ExecutionPolicy Unrestricted -File ', variables('nVIDIAdTeradiciLeostreamAgentsScriptFileName'), ' ', parameters('leostreamAgentVer'), ' ', parameters('teradiciAgentVer'), ' ', parameters('nvidiaVer'), ' ', parameters('storageAcc'), ' ', parameters('conName'), ' ', parameters('license'), ' ', parameters('CorrespondingAzureLocation'), ' ', parameters('useSpecificAzureDriver'), ' ', parameters('softwareExeNameinfolder'), ' ', parameters('OMSWorkSpaceId'), ' ', parameters('OMSWorkSpaceKey'), ' ', parameters('NuGetminVer4DockerEE'))]"
                    }
                }
            }]
        }
    ],
    "outputs": {
        "vm-fqdn": {
            "type": "string",
            "value": "[reference(parameters('publicIPAddressName'), '2016-03-30').dnsSettings.fqdn]"
        }
    }
}
